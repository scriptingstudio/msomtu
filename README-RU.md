# MSOMTU  
***Msomtu*** — скрипт конфигурации состава компонентов Microsoft Office (MSO).

## Описание
В Microsoft Office 2016 for Mac реализована изолированная архитектура компонентов (песочница), поэтому приложения хранят все необходимые ресурсы в своем собственном контейнере, и поэтому многие компоненты задублированы, что приводит к бесполезной трате дискового пространства. Этот скрипт безопасно удаляет «лишние» части следующих компонентов: 

* языковые пакеты локализации; 
* языковые пакеты проверки правописания; 
* дубликаты системных шрифтов;
* файлы описаний шрифтов (font*.plist).

## Требования
* Microsoft Office 2016 for Mac 15.17 и выше для работы с шрифтами.

## Основные возможности
* В скрипте реализован принцип **безопасного исполнения** — «защита от дураков». Режим исполнения по умолчанию — эмуляция. Скрипт не сможет внести изменения в систему без параметра `-run`. Это реализация режима **«что—если»**.
* **Аналитика** и **проактивная оценка**. Позволяет исследовать ресурсы приложений, таких как: шрифты, языки локализации, языки проверки правописания, и дисковое пространство, занятое этими ресурсами. Вы можете узнать размер ресурсов перед их удалением.
* **Поиск дубликатов шрифтов**. Поиск позволяет сравнить шрифтовые файлы в приложении с библиотечными шрифтами и обнаружить дубликаты.
* **Обнаружение новых шрифтов**. Поиск позволяет найти новые шрифты после обновления Офиса.
* **Предопределенные шрифтовые наборы** — предопределенные классы шрифтов, облегчающие операции с шрифтами. Классификация шрифтов в предопределенных наборах: кириллические, некириллические, иероглифические, символьные, системные. Предопределенные шрифтовые наборы не пересекаются.
* **Резервное копирование шрифтов**. Позволяет скопировать шрифты как в предопределенное, так в заданное место на диске перед удалением шрифтов.
* Копирование/перемещение шрифтов в библиотеки шрифтов.
* Мощные поисковые фильтры.
* Многоязычная справочная система. В этой версии: русский и английский. Неанглийские страницы реализованы в отдельном модуле. Вы можете дополнить систему любым языком на основе шаблона в модуле.
* Проверка новых версий.

## Примечания
* Так как приложения устанавливаются с привилегиями root, для запуска скрипта (когда нужно сделать изменения) необходимо использовать `sudo`.
* Удаление шрифтов работает только с версией MSO 15.17 и выше, поскольку Microsoft изменила организацию шрифтов. В папке `Fonts` обязательные шрифты, в `DFonts` — не обязательные.
* Если вы удаляете шрифты, также удаляйте файлы списков шрифтов (font*.plist); см. раздел ПАРАМЕТРЫ. Папка `DFonts` и файлы списков шрифтов не обязательны — их можно удалять. Шрифты в папках `DFonts` и `Fonts` не видны другим приложениям. Некоторые некириллические шрифты могут быть полезны — сохраните их перед удалением.
* **Внимание**: не удаляйте шрифты из папки `Fonts`! Они необходимы для работы самих приложений.
* Все файловые операции регистронезависимы.
* Скрипт необходимо запускать после каждого обновления программ MSO.
* Установки по умолчанию для параметров `-lang` и `-proof`: english и russian. Это зависит от системного языка и здравого смысла: для целостности MSO английский лучше оставить. Установки по умолчанию, специфичные для вашей системы, настраиваются прямо в скрипте. Ресурсы языков по умолчанию не удаляются.

## Использование

```sh
# Синтаксическая схема
$ [sudo] msomtu.sh [-<parameter> [<arguments>]]...

$ [sudo] msomtu.sh -backup [<destination>] [-app [<app>]] [-font [<font_pattern>]] [-ex|-x <font_pattern>] [-run|-ok]

$ [sudo] msomtu.sh [-app ["<app_list>"]] [-lang|-ui ["<lang_list>"]] [-proof|-p ["<proof_list>"]] [-font [<font_pattern>]] [-flist|-fl] [-ex|-x <font_pattern>] [-cache|-fc [u|user]] [-report|-rep|-info] [-verbose|-verb [nl]] [-fontset|-fs] [-all|-full] [-inv] [-help|-h|-? [en] [full]] [-run|-ok]
```

#### Сценарии использования
**Самостоятельные операции:** `-report`, `-fontset`, `-backup`, `-help`.

**Групповые операции:** `-font`, `-lang`, `-proof`, `-flist`, `-cache`, `-check`, `-all`.

| Действие  | Параметр |
|:--------|:----------|
| Просмотр статистики MSO | `-report` |
| Оценка экономии дискового пространства (в режиме просмотра) <br/><br/> | Шрифты: `-font -verbose nl` <br/>Языки локализации: `-lang -verbose nl` <br/>Проверка правописания: `-proof -verbose nl` <br/>Описания шрифтов: `-flist -verbose nl` |
| Просмотр/Удаление языков локализации | `-lang` |
| Просмотр/Удаление языковых пакетов правописания   | `-proof` |
| Просмотр/Удаление шрифтов | `-font` |
| Просмотр/Удаление дубликатов шрифтов | `-font lib` |
| Просмотр/Удаление файлов списков шрифтов | `-flist` |
| Просмотр наборов шрифтов     | `-fontset` |
| Очитска кэша шрифтов  | `-cache` |
| Поиск новых шрифтов    | `-font -inv` |
| Резервное копирование шрифтов     | `-backup -font` |
| Копирование шрифтов в библиотеки шрифтов | `-backup -font` |
| Проверка новых версий       | `-check` |
| Просмотр справочных страниц | Стандартная страница: без параметров <br/>Полная страница: `-help full` <br/>Английская страница: `-help en` |

## Аргументы
<table>
<tr><td valign="top"><code>app_list</code></td><td>Список выбора приложений. <b>w</b> — Word, <b>e</b> — Excel, <b>p</b> — PowerPoint, <b>o</b> — Outlook, <b>n</b> — OneNote. Значение по умолчанию: <code>w e p o n</code>.</td></tr>
<tr><td valign="top"><code>lang_list</code></td><td>Список языков локализации: <code>ru pl de</code> и т.д.; смотрите имена файлов с параметром <code>-verbose</code>. Значение по умолчанию: <code>en ru</code>.</td></tr>
<tr><td valign="top"><code>proof_list</code></td><td>Список языков проверки правописания: <code>russian finnish german</code> и т.д.; смотрите имена файлов с параметром <code>-verbose</code>. Можно использовать символ подстановки <code>*</code>. Значение по умолчанию: <code>english russian</code>.</td></tr>
<tr><td valign="top"><code>font_pattern</code></td><td>Операции со шрифтами выполняются на основе шаблонов. Шаблоны имен шрифтов: пустой — удаляется папка <code>DFonts</code> (по умолчанию); <i>fontset</i> — имя предопределенного набора; <i>mask</i> — маска имен шрифтов: <code>*.*</code>, <code>arial*</code>, <code>*.ttc</code> и т.д. При использовании одиночного символа подстановки <code>*</code>, заключайте его в двойные кавычки: <code>"*"</code>. Предопределенные наборы: <code>library</code>, <code>cyrdfonts</code>, <code>noncyr</code>, <code>chinese</code>, <code>sysfonts</code>, <code>symfonts</code>. См. описание параметра <code>-fontset</code> и код скрипта. Набор <code>library</code> удаляет дубликаты из системной и пользовательской библиотек шрифтов; так как сравнение выполняется по файлам (а не по семействам шрифтов), то совпадение не всегда будет полным. Также можно задавать списки наборов.</td></tr>
<tr><td valign="top"><code>destination</code></td><td>Путь к папке резервного копирования шрифтов. Значение по умолчанию: <code>~/Desktop/MSOFonts</code>. Можно применять синонимы предопределенных путей: <code>syslib</code> — системная библиотека; <code>userlib</code> — пользовательская библиотека.</td></tr>
</table>

## Параметры
**Примечание:** При обнаружении дубликатов входных параметров, аргументы последнего имеют приоритет.
<table>
<tr><td valign="top"><code>-all</code></td> <td>Ключ. Активация всех параметров очистки: <code>lang</code>, <code>proof</code>, <code>font</code>, <code>flist</code>, <code>cache</code>. Не влияет на параметр <code>-app</code>.</td></tr>
<tr><td valign="top"><code>-app</code></td> <td>Фильтр <code>app_list</code>. Список приложений, к которым применяются действия.</td></tr>
<tr><td valign="top"><code>-backup</code></td> <td>Резервное копирование шрифтов в заданную или предопределенную папку. Если целевая папка не существует, она будет создана. Для копирования шрифтов можно использовать системную и пользовательскую библиотеки; см. раздел АРГУМЕНТЫ. Этот параметр отменяет все операции удаления.</td></tr>
<tr><td valign="top"><code>-cache</code></td> <td>Ключ. Очистка кэша шрифтов (системный и текущего пользователя). С аргументом <code>user</code> удаляются только пользовательские данные. Не зависит от параметра <code>-run</code>.</td></tr>
<tr><td valign="top"><code>-check</code></td><td>Ключ. Проверка новых версий на веб-сайте; открывает веб-страницу в браузере.</td></tr>
<tr><td valign="top"><code>-ex</code></td> <td>Исключающий фильтр <code>font_pattern</code> для параметра <code>-font</code>. Фильтрует выбор пользователя. В качестве <code>font_pattern</code> можно использовать только маску.</td></tr>
<tr><td valign="top"><code>-flist</code></td> <td>Ключ. Удаление файлов списков шрифтов (font*.plist). Эти списки похожи на кэш. Если вы удаляете ненужный шрифт, необходимо очистить соответствующие списки. Поиск описаний шрифтов по файлам долгая операция, и нарушается целостность файлов, поэтому можно удалить все файлы.</td></tr>
<tr><td valign="top"><code>-font</code></td> <td>Фильтр <code>font_pattern</code>. Удаление заданных шрифтов или папки <code>DFonts</code>. Предопределенные наборы шрифтов: <code>cyrdfonts</code>, <code>noncyr</code>, <code>chinese</code>, <code>sysfonts</code>. Для шрифтов параметр <code>-inv</code> отменяет выбор пользователя и изменяет функцию поиска: будет произведен поиск новых шрифтов. Это проверку имеет смысл производить после обновления программ MSO. Аргумент <code>library</code> переключает поиск на библиотеки для обнаружения дубликатов.</td></tr>
<tr><td nowrap valign="top"><code>-fontset</code></td> <td>Ключ. Показывает предопределенные шрифтовые наборы.</td></tr>
<tr><td valign="top"><code>-help</code></td> <td>Ключ. Показывает страницу помощи. Язык текста зависит от системных языковых настроек. Есть два вида страницы: краткая и полная. По умолчанию (без параметров) выводится краткая страница. Для полного вида используйте параметр <code>-help full</code>. С аргументом <code>en</code> выводит английскую страницу помощи.</td></tr>
<tr><td valign="top"><code>-inv</code></td> <td>Ключ. Изменяет результат работы фильтров <code>-lang</code> и <code>-proof</code> на обратный, кроме умолчаний. Для параметра <code>-font</code> изменяется тип поиска.</td></tr>
<tr><td valign="top"><code>-lang</code></td> <td>Исключающий фильтр <code>lang_list</code>. Удаление языковых файлов локализации, кроме языков по умолчанию и выбора пользователя. Также см. параметр <code>-inv</code>; он инвертирует выбор пользователя, кроме умолчаний.</td></tr>
<tr><td valign="top"><code>-proof</code></td> <td>Исключающий фильтр <code>proof_list</code>. Удаление языковых файлов проверки правописания, кроме языков по умолчанию и выбора пользователя. Также см. параметр <code>-inv</code>; он инвертирует выбор пользователя, кроме умолчаний.</td></tr>
<tr><td valign="top"><code>-report</code></td> <td>Ключ. Показывает статистику по приложениям.</td></tr>
<tr><td valign="top"><code>-run</code></td> <td>Ключ. Разрешает режим изменений. Ключ действует как отмычка для воображаемой кнопки `ОК`; это также защита от случайных нажатий клавиши <code>Enter</code>.</td></tr>
<tr><td nowrap valign="top"><code>-verbose</code></td> <td>Ключ. Показывает детальную информацию по объектам выбора в режиме эмуляции. С аргументом `nl` отменяет вывод списка файлов. Не зависит от `-run`.</td></tr>
</table>

## Примеры
Показать статистику по приложениям:

```sh
$ msomtu.sh -report
```

Очистить все приложения с параметрами по умолчанию:

```sh
$ sudo msomtu.sh -all -run
```

Показать установленные языковые пакеты локализации для Word и Excel:

```sh
$ msomtu.sh -app "w e" -lang -verbose
```

Удалить заданные языковые пакеты локализации:

```sh
$ sudo msomtu.sh -lang "nl no de" -inv -run 
```

Удалить все языковые файлы правописания для Word:

```sh
$ sudo msomtu.sh -proof -app w -run 
```

Удалить заданные языковые файлы правописания:

```sh
$ sudo msomtu.sh -proof "Indonesian Isix*" -inv -run 
```

Найти в Word дубликаты шрифтов в библиотеках:

```sh
$ msomtu.sh -font lib -app w -verbose 
```

Удалить в Word дубликаты шрифтов в библиотеках:

```sh
$ sudo msomtu.sh -font lib -app w -run 
```

Удалить шрифты Arial и из набора `chinese`:

```sh
$ sudo msomtu.sh -font "chinese arial*" -run 
```

Найти новые шрифты в Outlook:

```sh
$ msomtu.sh -font -inv -app o 
```

Удалить в Word все шрифты, кроме заданных:

```sh
$ sudo msomtu.sh -font *.* -ex "brit* rockwell*" -app w -run 
```

Очистить кэш шрифтов:

```sh
$ sudo msomtu.sh -cache
```

Выполнить резервное копирование выбранных шрифтов по умолчанию:

```sh
$ msomtu.sh -backup -font "cyrdfonts britanic*" -run
```

Скопировать оригинальные русские шрифты в системную библиотеку:

```sh
$ sudo msomtu.sh -backup syslib -font cyrdfonts -run 
```

Показать предопределенные наборы шрифтов:

```sh
$ msomtu.sh -fontset
```

## Дополнительная информация
* Вдохновляющая идея «лишнего веса»: [ @goodbest ](https://github.com/goodbest/OfficeThinner)
* Руководство по шрифтам OS X и MSO: [Font Management in OS X, by Kurt Lang](http://www.jklstudios.com/misc/osxfonts.html)
